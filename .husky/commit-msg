#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Verificar firma de commit
echo "ğŸ” Verificando firma de commit..."

# Verificar si hay claves GPG disponibles
if ! gpg --list-secret-keys >/dev/null 2>&1; then
  echo "âš ï¸  No hay claves GPG configuradas"
  echo "ğŸ’¡ Para configurar: gpg --gen-key"
  exit 0
fi

# Verificar si el commit estÃ¡ firmado
SIGNATURE_STATUS=$(git log -1 --pretty=%G? 2>/dev/null)

case "$SIGNATURE_STATUS" in
  "G"|"U")
    echo "âœ… Commit firmado correctamente"
    ;;
  "B"|"X"|"Y"|"R"|"E")
    echo "âŒ Firma invÃ¡lida o corrupta"
    echo "ğŸ›‘ Commit no firmado - Requiere firma GPG vÃ¡lida"
    exit 1
    ;;
  "N")
    echo "âŒ Commit sin firma"
    echo "ğŸ›‘ Commit no firmado - Requiere firma GPG"
    echo "ğŸ’¡ Para firmar: git commit -S -m 'mensaje'"
    exit 1
    ;;
  *)
    echo "âš ï¸  Estado de firma desconocido: $SIGNATURE_STATUS"
    echo "ğŸ›‘ Commit no firmado - Requiere firma GPG"
    exit 1
    ;;
esac
